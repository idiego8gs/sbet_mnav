<!-- index.html - é¡¯ç¤º SBET mNAV çš„å¾©å¤ç¶²é ï¼Œé€éè‡ªæ¶ä¸­ä»‹ API é™ä½ Twelve Data ç”¨é‡ -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>SBET mNAV çœ‹æ¿</title>
  <style>
    body {
      background: #000;
      color: #33ff33;
      font-family: 'Courier New', monospace;
      padding: 2rem;
    }
    .box {
      border: 3px solid #33ff33;
      padding: 1rem 2rem;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      color: #ff33aa;
      text-align: center;
      font-size: 2rem;
    }
    .value-label {
      display: inline-block;
      width: 200px;
      color: #99ff99;
    }
    .value {
      font-size: 1.5rem;
    }
    #mnav {
      font-size: 2rem;
      color: #ffcc00;
    }
  </style>
</head>
<body>
  <div class="box">
    <h1>ğŸ“Ÿ SBET mNAV çœ‹æ¿</h1>
    <div><span class="value-label">SBET å¸‚å€¼ï¼š</span><span class="value" id="marketCap">è¼‰å…¥ä¸­...</span></div>
    <div><span class="value-label">ETH åƒ¹æ ¼ï¼š</span><span class="value" id="ethPrice">è¼‰å…¥ä¸­...</span></div>
    <div><span class="value-label">ETH æŒæœ‰é‡ï¼š</span><span class="value" id="ethAmount">è¼‰å…¥ä¸­...</span></div>
    <hr>
    <div class="value-label">â¤ mNAVï¼š</div>
    <div class="value" id="mnav">è¨ˆç®—ä¸­...</div>
  </div>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO6ExFyN8r3JLHutCpoJFPKdLlFq2yTQxMm_Bf5a5jtYvRF51PfOBcVa2FCIVFEznTxhQKWZQgypyb/pub?gid=0&single=true&output=csv"; // Google Sheets çš„ CSV å…¬é–‹ç¶²å€

    async function fetchEthHolding() {
      const res = await fetch(CSV_URL);
      const text = await res.text();
      const lines = text.trim().split("\n");
      return parseFloat(lines[1]);
    }

    async function fetchData() {
      try {
        const [ethAmount, apiRes] = await Promise.all([
          fetchEthHolding(),
          fetch("/api/sbet-data") // ä¸­ä»‹ APIï¼ŒåŒ…å« SBET å¸‚å€¼èˆ‡ ETH åƒ¹æ ¼
        ]);

        const apiData = await apiRes.json();
        const marketCap = parseFloat(apiData.market_cap);
        const ethPrice = parseFloat(apiData.eth_price);

        document.getElementById("marketCap").innerText = `$${marketCap.toLocaleString()}`;
        document.getElementById("ethPrice").innerText = `$${ethPrice}`;
        document.getElementById("ethAmount").innerText = ethAmount;

        const mnav = marketCap / (ethPrice * ethAmount);
        document.getElementById("mnav").innerText = `$${mnav.toFixed(2)}`;

      } catch (err) {
        console.error(err);
        document.getElementById("mnav").innerText = "âš ï¸ æŠ“å–éŒ¯èª¤";
      }
    }

    fetchData();
    setInterval(fetchData, 150000); // æ¯ 2 åˆ†åŠæ›´æ–°
  </script>
</body>
</html>
